(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product/addGoods/index"],{"15d0":function(e,t,a){"use strict";a.r(t);var i=a("d3f3"),o=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=o.a},"3f3e":function(e,t,a){"use strict";var i=a("a1cb"),o=a.n(i);o.a},"42b1":function(e,t,a){"use strict";a.r(t);var i=a("93c7"),o=a("f9ff");for(var n in o)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(n);a("ea75");var s=a("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"4c716614",null,!1,i["a"],void 0);t["default"]=r.exports},7804:function(e,t,a){},"93c7":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return o})),a.d(t,"a",(function(){}));var i=function(){var e=this.$createElement;this._self._c},o=[]},a1cb:function(e,t,a){},a403:function(e,t,a){"use strict";(function(e){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(a("9523")),n=a("f26a"),s=i(a("2e02")),r=a("5a8f"),c=a("0b33");function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach((function(t){(0,o.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={components:{},props:{merId:{type:[String,Number],default:""},product_id:{type:[String,Number],default:""},resetKey:{type:Boolean,default:!1}},data:function(){return{disModel:!1,upload_max:10,uploadUrl:"".concat(n.HTTP_REQUEST_URL,"/api/upload/video"),addGoodsSecoundData:{is_good:0,is_gift_bag:0,sort:"",once_count:"",video_link:""}}},created:function(){this.initData()},watch:{addGoodsSecoundData:{handler:function(e){var t=this;setTimeout((function(){(0,r.setStorage)(t.product_id?"editGoodsDetils":"addGoodsSecoundData",e)}))},deep:!0},resetKey:{handler:function(e){this.initData()}}},methods:{initData:function(){var e=this,t={};if((0,r.getStorage)("goodsDis")&&(this.disModel=!0),this.product_id)return t=(0,r.getStorage)("editGoodsDetils"),Object.keys(this.addGoodsSecoundData).forEach((function(a){e.addGoodsSecoundData[a]=t[a]})),t.content&&((0,r.setStorage)("goodsDis",{store_name:t.content.title,imageList:t.content.image}),this.disModel=!0),void(0,r.setStorage)("canChangeSecound",!0);(0,r.getStorage)("addGoodsSecoundData")&&Object.keys(this.addGoodsSecoundData).forEach((function(t){((0,r.getStorage)("addGoodsSecoundData")[t]||0==(0,r.getStorage)("addGoodsSecoundData")[t])&&(e.addGoodsSecoundData[t]=(0,r.getStorage)("addGoodsSecoundData")[t])}))},lastStep:function(){this.$emit("lastStep")},submitCreatedGoods:function(){var t=this;(0,r.Loading)();var a=["addGoodsFormData","singleSpecification","attrValue","modifyPriceData","addGoodsSecoundData","goodsDis","editGoodsDetils","canChange","canChangeSecound"],i=0==(0,r.getStorage)("addGoodsFormData").spec_type?[(0,r.getStorage)("singleSpecification")]:(0,r.getStorage)("attrValue"),o=l(l(l({},this.addGoodsSecoundData),(0,r.getStorage)("addGoodsFormData")),{},{content:{title:(0,r.getStorage)("goodsDis")?(0,r.getStorage)("goodsDis").store_name:"",image:(0,r.getStorage)("goodsDis")?(0,r.getStorage)("goodsDis").imageList:[]},video_link:this.addGoodsSecoundData.video_link});o.attrValue=i.filter((function(e){return""!=e})),(0,r.getStorage)("addGoodsFormData").spec_type,this.product_id?(0,c.productUpdate)(this.merId,this.product_id,o).then((function(i){a.forEach((function(e){(0,r.getStorage)(e)&&(0,r.removeStorage)(e)})),(0,r.hideLoading)(),(0,r.Modal)("提交成功","点击确定，返回商品管理",{showCancel:!1}).then((function(){e.redirectTo({url:"/pages/product/goodsOnSale/index?mer_id="+t.merId})}))})).catch((function(e){(0,r.Toast)(e)})):(0,c.productCreate)(this.merId,o).then((function(i){a.forEach((function(e){(0,r.getStorage)(e)&&(0,r.removeStorage)(e)})),(0,r.hideLoading)(),(0,r.Modal)("提交成功","点击确定，返回商品管理",{showCancel:!1}).then((function(){e.redirectTo({url:"/pages/product/goodsOnSale/index?mer_id="+t.merId})}))})).catch((function(e){(0,r.Toast)(e)}))},isGood:function(e){this.addGoodsSecoundData.is_good=e.detail.value?1:0},isGiftBag:function(e){this.addGoodsSecoundData.is_gift_bag=e.detail.value?1:0},switchChange:function(e,t){this.addGoodsSecoundData[t.model]=e?1:0},inputGoodsDetils:function(){(0,r.navigateTo)(1,"/pages/product/addGoods/addGoodDetils",{mer_id:this.merId})},uploadVideo:function(){var t=this;e.chooseVideo({sourceType:["camera","album"],success:function(a){Math.ceil(a.size/1024)<1024*t.upload_max?e.uploadFile({url:t.uploadUrl,filePath:a.tempFilePath,name:"file",formData:{user:"test"},header:(0,o.default)({"Content-Type":"multipart/form-data"},n.TOKENNAME,"Bearer "+s.default.state.app.token),success:function(e){var a=JSON.parse(e.data);t.addGoodsSecoundData.video_link=a.data.src},complete:function(e){}}):e.showModal({title:"提示",content:"视频超出限制".concat(t.upload_max,"MB,已过滤")})},fail:function(t){e.showModal({content:JSON.stringify(t)})}})},deleteImage:function(e){this.addGoodsSecoundData.video_link=""}}};t.default=u}).call(this,a("543d")["default"])},b652:function(e,t,a){"use strict";a.r(t);var i=a("e4fc"),o=a("15d0");for(var n in o)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(n);a("3f3e");var s=a("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"2fb8d0ba",null,!1,i["a"],void 0);t["default"]=r.exports},b906:function(e,t,a){"use strict";(function(e,t){var i=a("4ea4");a("4c7d");i(a("66fd"));var o=i(a("b652"));e.__webpack_require_UNI_MP_PLUGIN__=a,t(o.default)}).call(this,a("bc2e")["default"],a("543d")["createPage"])},d3f3:function(e,t,a){"use strict";(function(e){var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(a("2eee")),n=i(a("9523")),s=i(a("448a")),r=i(a("c973")),c=a("5a8f"),d=a("0b33"),l=i(a("42b1")),u=a("f26a"),f=i(a("2e02"));var m={components:{inputGoodsDetils:function(){Promise.all([a.e("common/vendor"),a.e("pages/product/components/inputGoodsDetils")]).then(function(){return resolve(a("63c7"))}.bind(null,a)).catch(a.oe)},linkageAssembly:function(){a.e("pages/product/components/linkageAssembly").then(function(){return resolve(a("67d8"))}.bind(null,a)).catch(a.oe)},attr:function(){a.e("pages/product/components/attr").then(function(){return resolve(a("5a5d"))}.bind(null,a)).catch(a.oe)},platfrom:function(){a.e("pages/product/components/platform").then(function(){return resolve(a("4bb3"))}.bind(null,a)).catch(a.oe)},storeClassification:function(){a.e("pages/product/components/store_classification").then(function(){return resolve(a("b97c"))}.bind(null,a)).catch(a.oe)},secound:l.default,avatar:function(){Promise.all([a.e("common/vendor"),a.e("components/yq-avatar/yq-avatar")]).then(function(){return resolve(a("b70d"))}.bind(null,a)).catch(a.oe)}},data:function(){return{step:1,setFormData:{imageList:[],specification:"",image:"",slider_image:"",store_name:"",store_info:"",keyword:"",brand_id:"",brand_name:"",cate_id:"",cate_name:"",mer_cate_id:"",mer_cate_name:"",unit_name:"",spec_type:"0",attr:[],specifica:"",setSpecificaValue:"",setSpecificaValue2:"",delivery_way:[],delivery_free:"1",temp_id:"",tempName:""},popupContainerKey:!1,productItem:{}||[],selectProductTitle:"选择平台分类",specificationsRadioList:[{value:"0",name:"单规格"},{value:"1",name:"多规格"}],specifications:[{id:5,label:"规格选择",type:"radio",model:"spec_type",inforValue:"0",radioList:[{value:"0",name:"单规格"},{value:"1",name:"多规格"}]},{id:7,label:"选择规格",type:"select",model:"attr",singleColumn:!0,value:"",DoNotShow:!0,holder:"去选择",jumpLogic:!0},{id:6,label:"商品规格",type:"select",value:"",holder:"去设置",jumpLogic:!0,DoNotShow:!0}],deliveryType:[],deliveryFreeList:[{value:"1",name:"到店核销"},{value:"2",name:"快递配送"}],merId:"",product_id:"",isUpload:!0,templateListPage:{page:1,limit:1e4},classified:{cate_id:[],mer_cate_id:[],brand_id:[],attr:[],temp_id:[]},platformClassificationData:[],merchantClassification:[],brand:[],specificationClassification:[],selectEdAttr:[],canChange:!0,secoundModel:!1,resetKey:!1,imgName:""}},onLoad:function(e){this.merId=e.mer_id,this.product_id=e.product_id,this.getDeliveryType(),this.initData(),this.product_id&&this.initDataEditData()},onShow:function(){this.setFormData.setSpecificaValue="",this.setFormData.setSpecificaValue2="",(0,c.getStorage)("singleSpecification")?this.setFormData.setSpecificaValue="点击修改价格":this.setFormData.setSpecificaValue="",(0,c.getStorage)("attrValue")?this.setFormData.setSpecificaValue2="点击修改价格":this.setFormData.setSpecificaValue2="",2==this.step&&(this.secoundModel=!this.secoundModel)},watch:{setFormData:{handler:function(e){var t=this;setTimeout((function(){(0,c.setStorage)("addGoodsFormData",t.setFormData)}))},deep:!0},"setFormData.imageList":function(e){this.setFormData.image=e.length?e[0]:"",this.setFormData.slider_image=e.length?(0,c.serialize)(e).splice(1):[]}},methods:{initData:function(){var e=this;return(0,r.default)(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return(0,c.getStorage)("addGoodsFormData")&&(e.setFormData=(0,c.getStorage)("addGoodsFormData"),e.selectEdAttr=(0,c.getStorage)("modifyPriceData")),t.next=3,(0,d.categoryBrandlist)(e.merId);case 3:return e.brand=t.sent.data,t.next=6,(0,d.categorySelect)(e.merId);case 6:return e.merchantClassification=t.sent.data,t.next=9,(0,d.categoryList)(e.merId);case 9:e.platformClassificationData=t.sent.data;case 10:case"end":return t.stop()}}),t)})))()},getDeliveryType:function(){var e=this;(0,d.getDeliveryType)(e.merId).then((function(t){e.deliveryType=t.data.delivery_way.map(String),e.product_id||(e.setFormData.delivery_way=e.deliveryType),2==e.deliveryType.length?e.deliveryFreeList=[{value:"1",name:"到店核销"},{value:"2",name:"快递配送"}]:1==e.deliveryType.length&&"1"==e.deliveryType[0]?e.deliveryFreeList=[{value:"1",name:"到店核销"}]:e.deliveryFreeList=[{value:"2",name:"快递配送"}]}),(function(t){e.$util.Tips({title:t.msg})}))},initDataEditData:function(){var e=this;(0,c.Loading)(),this.setFormData={imageList:[],specification:"",image:"",slider_image:"",store_name:"",store_info:"",keyword:"",brand_id:"",brand_name:"",cate_id:"",cate_name:"",mer_cate_id:"",mer_cate_name:"",unit_name:"",spec_type:"0",attr:[],specifica:"",setSpecificaValue:"",setSpecificaValue2:"",delivery_way:[],delivery_free:"0",temp_id:"",tempName:""},(0,c.getStorage)("editGoodsDetils")&&(0,c.removeStorage)("editGoodsDetils"),(0,d.productDetail)(this.merId,this.product_id).then((function(t){(0,c.setStorage)("editGoodsDetils",t.data);var a=t.data;Object.keys(e.setFormData).forEach((function(t){e.setFormData[t]=a[t]})),e.setFormData.product_id=e.product_id,e.setFormData.imageList=[].concat((0,s.default)(e.setFormData.image?[e.setFormData.image]:[]),(0,s.default)(e.setFormData.slider_image)),e.setFormData.cate_name=a.storeCategory.cate_name,e.setFormData.mer_cate_name=a.merCateId?a.merCateId.map((function(e){return e.category&&e.category.cate_name})).join(","):"",e.setFormData.brand_name=a.brand?a.brand.brand_name:"",1==e.setFormData.spec_type&&(a.attr.length&&(e.setFormData.specifica="点击修改规格"),a.attrValue.length&&(e.setFormData.setSpecificaValue2="点击修改价格")),0==a.spec_type&&((0,c.setStorage)("singleSpecification",a.attrValue[0]),a.attrValue.length&&(e.setFormData.setSpecificaValue="点击修改价格")),(0,c.setStorage)("attrValue",a.attrValue),a.temp&&(e.setFormData.tempName=a.temp.name),(0,c.setStorage)("canChange",!0),(0,c.hideLoading)()}))},handleChooseImage:function(){var e=this;e.$util.uploadImageOne("upload/image",(function(t){e.setFormData.imageList.push(t.data.path)}))},clk:function(){var e=this.$refs.avatar;e.fChooseImg(1,{selWidth:"350upx",selHeight:"350upx",inner:!0})},doUpload:function(t){var a=this;e.uploadFile({url:u.HTTP_REQUEST_URL+"/api/upload/image/field",filePath:t.path,name:"field",formData:{filename:t.path,name:a.imgName},header:(0,n.default)({"Content-Type":"multipart/form-data"},u.TOKENNAME,"Bearer "+f.default.state.app.token),success:function(e){var t=JSON.parse(e.data);a.setFormData.imageList.push(t.data.path)},complete:function(e){}})},getImgName:function(e){this.imgName=e},deleteImage:function(e){this.setFormData.imageList.splice(e,1)},selectPlatform:function(){this.$refs.select_platform.open()},closePlatfrom:function(){this.$refs.select_platform.close()},getPlatData:function(e,t){this.setFormData.cate_id=e.value,this.setFormData.cate_name=e.label,this.$refs.select_platform.close()},selectStoreClass:function(){this.$refs.select_store.open()},merchantClose:function(){this.$refs.select_store.close()},handleGetSelectStore:function(e){this.setFormData.mer_cate_id=e.map((function(e){return e.value})),this.setFormData.mer_cate_name=e.map((function(e){return e.label})).join(","),this.$refs.select_store.close()},selectBrand:function(){this.$refs.select_popup.open()},getLinkageData:function(e){this.setFormData.brand_id=e[0].value,this.setFormData.brand_name=e[0].label,this.$refs.select_popup.close()},multipleList:function(e,t){"mer_cate_id"==t&&(this.platformClassification[1].value=e.map((function(e){return e.label})).join("，"),this.platformClassification[1].allreadySelect=e,this.setFormData.mer_cate_id=e.map((function(e){return e.value})))},close:function(){this.$refs.select_popup.close()},getLinkDataOfRecursion:function(e){var t="",a="";return e.forEach((function(e){t=e.label,a=e.value})),{str:t,id:a}},formInitData:function(e,t){this.setFormData[t]=e},handleRadioChange:function(e,t){this.setFormData[t.model]=e},specificationsRadioChange:function(e){this.setFormData.spec_type=e.detail.value},selectSpecification:function(){var e=this;(0,d.attrList)(this.merId,{page:1,limit:1e4}).then((function(t){e.specificationClassification=t.data.list,e.classified["attr"]=e.specificationClassification,e.specificationClassification.forEach((function(t){e.$set(t,"value",t.attr_template_id),e.$set(t,"label",t.template_name),e.$refs.attr.open()}))}))},selectAttr:function(e){(0,c.getStorage)("attrValue")&&(0,c.removeStorage)("attrValue"),this.setFormData.specifica=e.template_name,this.setFormData.attr=[],this.setFormData.attr=this.setFormData.attr.concat(e.template_value),this.selectEdAttr=e,this.$refs.attr.close()},setSpecifica:function(){if(0!=this.setFormData.spec_type){if(1==this.setFormData.spec_type){var e=(0,c.serialize)(this.selectEdAttr);return(0,c.setStorage)("modifyPriceData",e),void(0,c.navigateTo)(1,"/pages/product/addGoods/modifyPrice")}}else(0,c.navigateTo)(1,"/pages/product/addGoods/singleSpecification")},switchChange:function(e,t){"delivery_free"==t.model&&(this.setFormData[t.model]=e?"1":"0")},checkChange:function(e,t){this.setFormData[t.model]=e,"delivery_way"==t.model&&(e.includes("2")?this.transport[1].DoNotShow=!1:this.transport[1].DoNotShow=!0)},handleClose:function(){this.$refs.select_popup.close()},deliveryWayChange:function(e){this.setFormData.delivery_way=e.detail.value},deliveryFreeChange:function(e){e.detail.value?this.setFormData.delivery_free="1":this.setFormData.delivery_free="0"},tempIdSelect:function(){this.getTemplateList()},getTemplateList:function(){var e=this;(0,d.templateList)(this.merId,this.templateListPage).then((function(t){t.data.list.forEach((function(t){e.$set(t,"value",t.shipping_template_id),e.$set(t,"label",t.name)})),e.classified["temp_id"]=t.data.list,e.$refs.tempId.open()}))},scrolltolower:function(){},getTempIdData:function(e){this.setFormData.temp_id=e[0].value,this.setFormData.tempName=e[0].label,this.$refs.tempId.close()},setGoodsTemp:function(){(0,c.navigateTo)(1,"/pages/product/addGoods/freightTemplate",{mer_id:this.merId})},handleNextStep:function(){var e=this,t=!0,a={image:"请选择主图",store_name:"请输入商品名",cate_id:"请选择平台分类",mer_cate_id:"请选择店铺分类",unit_name:"请输入商品单位"};Object.keys(a).some((function(i){if(!e.setFormData[i])return(0,c.Toast)(a[i]),void(t=!1)})),("0"!=this.setFormData.spec_type||this.setFormData.setSpecificaValue)&&("1"!=this.setFormData.spec_type||this.setFormData.setSpecificaValue2)?this.setFormData.delivery_way.length?t&&(this.step=2):(0,c.Toast)("请选择送货方式"):(0,c.Toast)("商品价格不能为空")},lastStep:function(){this.step=1}}};t.default=m}).call(this,a("543d")["default"])},e4fc:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}));var i={uniPopup:function(){return a.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(a.bind(null,"b4af"))}},o=function(){var e=this,t=e.$createElement,a=(e._self._c,1==e.step&&e.setFormData.store_name?e.setFormData.store_name.length:null),i=1==e.step?e.setFormData.imageList.length:null,o=1==e.step&&e.setFormData.store_info?e.setFormData.store_info.length:null,n=1==e.step?e.deliveryType.length:null,s=1==e.step&&2==n?e.__map(e.deliveryFreeList,(function(t,a){var i=e.__get_orig(t),o=e.setFormData.delivery_way.includes(t.value);return{$orig:i,g4:o}})):null,r=1==e.step?e.setFormData.delivery_way.includes("2"):null,c=1==e.step?e.setFormData.delivery_way.includes("2")&&0==e.setFormData.delivery_free:null;e._isMounted||(e.e0=function(t){return e.$refs.tempId.close()},e.e1=function(t){return e.$refs.attr.close()}),e.$mp.data=Object.assign({},{$root:{g0:a,g1:i,g2:o,g3:n,l0:s,g5:r,g6:c}})},n=[]},ea75:function(e,t,a){"use strict";var i=a("7804"),o=a.n(i);o.a},f9ff:function(e,t,a){"use strict";a.r(t);var i=a("a403"),o=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=o.a}},[["b906","common/runtime","common/vendor"]]]);