(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/admin/delivery/index"],{"0e95":function(e,t,i){"use strict";(function(e,t){var r=i("4ea4");i("4c7d");r(i("66fd"));var n=r(i("fa33"));e.__webpack_require_UNI_MP_PLUGIN__=i,t(n.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},"1b9c":function(e,t,i){},"8e66":function(e,t,i){"use strict";var r=i("1b9c"),n=i.n(r);n.a},"97e5":function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,i=(e._self._c,e.logistics.length),r=i>0&&4==e.delivery_type?e.expTemp.length>0&&4==e.delivery_type:null,n=e.delivery.orderProduct&&(e.delivery.orderProduct.length>1||1==e.delivery.orderProduct.length&&e.delivery.orderProduct[0]["refund_num"]>1)&&2!=e.activity_type,a=!e.curSplit&&e.delivery.orderProduct?e.delivery.orderProduct.length:null,d=!e.curSplit&&e.delivery.orderProduct?e.delivery.orderProduct.length:null;e.$mp.data=Object.assign({},{$root:{g0:i,g1:r,g2:n,g3:a,g4:d}})},n=[]},f1d0:function(e,t,i){"use strict";i.r(t);var r=i("f70f"),n=i.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a);t["default"]=n.a},f70f:function(e,t,i){"use strict";(function(e){var r=i("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(i("2eee")),a=r(i("c973")),d=i("316e"),o=i("26cb"),u=i("59c6"),s=(i("5a7e"),i("f26a")),c={name:"GoodsDeliver",components:{},props:{},data:function(){return{types:[{type:1,title:"发货"},{type:2,title:"送货"},{type:3,title:"无需物流"}],splitList:[{title:"开启",key:1},{title:"关闭",key:0}],curSplit:0,curExpress:1,active:0,order_id:"",delivery:{user:{}},logistics:[],delivery_type:1,delivery_name:"",to_phone:"",to_name:"",remark:"",mark:"",cargo_weight:0,delivery_id:"",mer_config_temp_id:"",mer_from_com:"",seIndex:0,storeIndex:0,merId:"",expIndex:0,expTemp:[],from_name:"",from_tel:"",from_addr:"",fictitious_content:"",isTemp:!1,isDelivery:!1,is_virtual:0,splitProducts:[],storeList:[],activity_type:0,domain:s.HTTP_REQUEST_URL}},watch:{"$route.params.oid":function(e){void 0!=e&&(this.order_id=e,this.getIndex())}},computed:(0,o.mapGetters)(["viewColor"]),onLoad:function(e){this.order_id=e.id,this.merId=e.merId,this.getIndex(),this.expressList(),this.orderDeliveryInfo()},methods:{scanCode:function(){var t=this;e.scanCode({scanType:["barCode"],success:function(e){var i=e.result.split(",");t.delivery_id=1==i.length?i[0]:i[1]}})},previewImage:function(){e.previewImage({urls:[this.expTemp[this.expIndex].pic],success:function(){},fail:function(e){}})},isOpenDeliveryTemp:function(e){var t=this;(0,d.getTempAndDelivery)(t.merId).then((function(i){1==e?(t.delivery_type=3,t.types=[{type:3,title:"虚拟发货"}]):(1==i.data.crmeb_serve_dump&&t.types.push({type:4,title:"电子面单"}),1==i.data.delivery_status&&t.types.push({type:5,title:"同城配送"}))}),(function(e){t.$util.Tips({title:e})}))},getDump:function(){var e=this;e.expTemp.forEach((function(t,i){t.temp_id!=e.mer_config_temp_id||(e.expIndex=i)}))},getStoreList:function(){var e=this;(0,d.getDeliveryStoreLst)(this.merId).then((function(t){e.storeList=t.data})).catch((function(t){e.$util.Tips({title:t})}))},changeType:function(e,t){this.active=t,this.delivery_type=e.type,this.delivery_name="",this.delivery_id="",5==e.type&&this.getStoreList()},changeSplit:function(e,t){this.curSplit=e.key},getIndex:function(){var e=this;(0,d.getAdminOrderDetail)(e.merId,e.order_id).then((function(t){t.data.orderProduct.forEach((function(e,t){e.checked=!0,e.split_num=e.refund_num})),e.delivery=t.data,e.activity_type=t.data.activity_type,e.is_virtual=t.data.is_virtual,e.isOpenDeliveryTemp(e.is_virtual)}),(function(t){e.$util.Tips({title:t})}))},expressList:function(){var e=this;(0,u.expressList)().then((function(t){e.logistics=t.data,e.getExpTemp(t.data[0].value)}),(function(t){e.$util.Tips({title:t})}))},checkedChange:function(e){e.checked=!e.checked},getSplitProduct:function(){var e=[];return this.delivery.orderProduct.map((function(t){t.checked&&e.push({id:t.order_product_id,num:t.split_num})})),e},subCart:function(e){e.split_num>1&&e.split_num--},addCart:function(e){e.split_num<e.refund_num&&e.split_num++},saveInfo:function(){var e=this;return(0,a.default)(n.default.mark((function t(){var i,r,a,d,o;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e,r=i.delivery_type,a=i.logistics[i.seIndex].value,d=i.delivery_id,o={},o.delivery_name=a,o.delivery_type=r,o.is_split=i.curSplit,!i.curSplit){t.next=8;break}if(i.splitProducts=i.getSplitProduct(),0!=i.splitProducts.length){t.next=8;break}return t.abrupt("return",e.$util.Tips({title:"请选择分单商品"}));case 8:if(o.split=i.splitProducts,1!=r){t.next=14;break}if(d){t.next=12;break}return t.abrupt("return",e.$util.Tips({title:"请填写快递单号"}));case 12:o.delivery_id=d,i.setInfo(o);case 14:if(2!=r){t.next=24;break}if(i.to_name){t.next=17;break}return t.abrupt("return",e.$util.Tips({title:"请填写送货人姓名"}));case 17:if(i.to_phone){t.next=19;break}return t.abrupt("return",e.$util.Tips({title:"请填写送货人手机号码"}));case 19:if(/^1[3456789]\d{9}$/.test(i.to_phone)){t.next=21;break}return t.abrupt("return",e.$util.Tips({title:"请填写正确的手机号码"}));case 21:o.delivery_name=i.to_name,o.delivery_id=i.to_phone,i.setInfo(o);case 24:if(3==r&&(o.remark=i.remark,i.setInfo(o)),4!=r){t.next=41;break}if(i.from_name){t.next=28;break}return t.abrupt("return",e.$util.Tips({title:"请填写寄件人姓名"}));case 28:if(i.from_tel){t.next=30;break}return t.abrupt("return",e.$util.Tips({title:"请填写寄件人手机号码"}));case 30:if(/^1[3456789]\d{9}$/.test(i.from_tel)){t.next=32;break}return t.abrupt("return",e.$util.Tips({title:"请填写正确的手机号码"}));case 32:if(i.from_addr){t.next=34;break}return t.abrupt("return",e.$util.Tips({title:"请填写寄件人地址"}));case 34:if(0!=i.expTemp.length){t.next=36;break}return t.abrupt("return",e.$util.Tips({title:"请选择电子面单"}));case 36:o.from_name=i.from_name,o.from_tel=i.from_tel,o.from_addr=i.from_addr,o.temp_id=i.expTemp[i.expIndex].temp_id,i.setInfo(o);case 41:5==r&&(o.station_id=i.storeList[i.storeIndex].value,o.cargo_weight=i.cargo_weight,o.mark=i.mark,i.setInfo(o));case 42:case"end":return t.stop()}}),t)})))()},setInfo:function(t){var i=this;(0,d.setAdminOrderDelivery)(i.merId,i.order_id,t).then((function(t){i.$util.Tips({title:t.message,icon:"success",mask:!0});var r=i.is_virtual?4:3;setTimeout((function(t){e.redirectTo({url:"/pages/admin/orderList/index?types=".concat(r,"&merId=").concat(i.merId)})}),1e3)}),(function(e){i.$util.Tips({title:e})}))},bindPickerChange:function(e){this.seIndex=e.detail.value,this.getExpTemp(this.logistics[e.detail.value].value)},bindTempChange:function(e){this.expIndex=e.detail.value},bindStoreChange:function(e){this.storeIndex=e.detail.value},getExpTemp:function(e){var t=this;(0,d.orderExportTemp)({com:e}).then((function(e){t.expTemp=e.data.data}))},orderDeliveryInfo:function(){var e=this;(0,d.orderDeliveryInfo)(e.merId).then((function(t){e.from_name=t.data.mer_from_name,e.from_tel=t.data.mer_from_tel,e.from_addr=t.data.mer_from_addr,e.mer_config_temp_id=t.data.mer_config_temp_id,e.mer_from_com=t.data.mer_from_com}),(function(t){e.$util.Tips({title:t})}))}}};t.default=c}).call(this,i("543d")["default"])},fa33:function(e,t,i){"use strict";i.r(t);var r=i("97e5"),n=i("f1d0");for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);i("8e66");var d=i("f0c5"),o=Object(d["a"])(n["default"],r["b"],r["c"],!1,null,"094aa8ad",null,!1,r["a"],void 0);t["default"]=o.exports}},[["0e95","common/runtime","common/vendor"]]]);