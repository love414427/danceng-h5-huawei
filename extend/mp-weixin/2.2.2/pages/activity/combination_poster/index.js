(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/combination_poster/index"],{"20c1":function(t,e,a){"use strict";a.r(e);var n=a("41388"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},41388:function(t,e,a){"use strict";(function(t){var n=a("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("2eee")),s=n(a("278c")),o=n(a("c973")),c=a("6859"),r=a("26cb"),u={computed:(0,r.mapGetters)(["viewColor"]),data:function(){return{wd:225,hg:357,posterImage:"",posterBag:"../static/images/poster-bag.png"}},props:{picData:{type:Object},posterStatus:{type:Boolean,default:!1}},watch:{posterStatus:function(t){t&&this.posterShow()}},onLoad:function(){},methods:{posterShow:function(){var e=this;return(0,o.default)(i.default.mark((function a(){var n,s;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e,t.showLoading({title:"海报生成中",mask:!0}),a.next=4,n.imgToBase(n.picData.goodsPic);case 4:return a.sent,a.next=7,n.imgToBase(n.picData.codePic);case 7:return a.sent,a.t0=n.posterBag,a.next=11,n.downloadFilestoreImage(n.picData.goodsPic);case 11:return a.t1=a.sent,a.next=14,n.downloadFilestoreImage(n.picData.codePic);case 14:a.t2=a.sent,s=[a.t0,a.t1,a.t2],n.bargainPosterCanvas(s,n.picData.title,n.picData.label,n.picData.msg,n.picData.price,n.wd,n.hg,(function(t){n.posterImage=t}));case 17:case"end":return a.stop()}}),a)})))()},imgToBase:function(t){return(0,o.default)(i.default.mark((function e(){var a;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,c.imgToBase)({image:t});case 2:return a=e.sent,e.abrupt("return",a.data.image);case 4:case"end":return e.stop()}}),e)})))()},savePosterPath:function(e){var a=this;t.getSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e,success:function(t){a.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){a.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e,success:function(t){a.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){a.$util.Tips({title:"保存失败"})}})}})}})},posterImageClose:function(){this.$emit("update:posterStatus",!1),this.posterImage=""},downloadFilestoreImage:function(e){var a=this,n="https:"==e.split("//")[0];return n||(e="https://"+e.split("//")[1]),new Promise((function(n,i){var s=a;t.downloadFile({url:e,success:function(t){n(t.tempFilePath)},fail:function(){return s.$util.Tips({title:""})}})}))},bargainPosterCanvas:function(e,a,n,i,o,c,r,u){var l=this,f=this,p=t.createCanvasContext("myCanvas",this);p.clearRect(0,0,0,0),p.fillStyle="#ccc",p.fillRect(0,0,c,r),t.getImageInfo({src:e[0],success:function(d){d.width,d.height;p.drawImage(e[0],0,0,c,r);p.drawImage(e[1],.1571*c,.2916*r,.6857*c,.3916*r),p.save(),p.drawImage(e[2],.385*c,.77*r,55,55),p.save();var h=f.textByteLength(a,30),g=(0,s.default)(h,3),v=(g[0],g[1]),m=g[2];if(m>2){m=2;var w=v.slice(0,2);w[w.length-1]+="…",v=w}p.setTextAlign("left"),p.setFillStyle("#000"),v.length<2?p.setFontSize(14):p.setFontSize(12);for(var x=0;x<v.length;x++)x?p.fillText(v[x],20,20+3*x+13,1100):p.fillText(v[x],20,20,1100);p.setTextAlign("left"),p.setFontSize(10),p.setFillStyle("#FFF"),p.fillText(n,.6656*c,.167*r),p.save(),p.setFillStyle("red"),p.font="bold 18px Arial",p.fillText(o,.1847*c,.175*r),p.save(),p.setFontSize(8),p.setFillStyle("#3F3F3F"),p.fillText(i,.1036*c,.2306*r),p.save(),p.draw(!0,(function(){t.canvasToTempFilePath({canvasId:"myCanvas",fileType:"png",quality:1,success:function(e){u&&u(e.tempFilePath),t.hideLoading()}},l)}))},fail:function(e){t.hideLoading(),f.Tips({title:"无法获取图片信息"})}})},textByteLength:function(t,e){for(var a=0,n=1,i=0,s=[],o=0;o<t.length;o++)t.charCodeAt(o)>255?(a+=2,a>n*e&&(a++,s.push(t.slice(i,o)),i=o,n++)):(a++,a>n*e&&(s.push(t.slice(i,o)),i=o,n++));return s.push(t.slice(i,t.length)),[a,s,n]}}};e.default=u}).call(this,a("543d")["default"])},"4a20":function(t,e,a){"use strict";var n=a("67f3"),i=a.n(n);i.a},"67f3":function(t,e,a){},8036:function(t,e,a){"use strict";a.r(e);var n=a("e9ae"),i=a("20c1");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("4a20");var o=a("f0c5"),c=Object(o["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=c.exports},e9ae:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},i=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'pages/activity/combination_poster/index-create-component',
    {
        'pages/activity/combination_poster/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("8036"))
        })
    },
    [['pages/activity/combination_poster/index-create-component']]
]);
