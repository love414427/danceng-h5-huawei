(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/users/wechat_login/index"],{"562f":function(t,e,n){"use strict";(function(t,i){var o=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("9523")),c=n("cd6d"),s=n("937f"),r=n("6859"),u=o(n("823f")),d=(o(n("42cb")),o(n("42cb")),n("f26a")),l=n("3255"),f=o(n("a50e")),h=(n("ddb3"),n("26cb"));function g(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}var p=getApp(),m=t.getSystemInfoSync().statusBarHeight+"px",_={data:function(){return{domain:d.HTTP_REQUEST_URL,isUp:!1,canClose:!0,phone:"",statusBarHeight:m,isHome:!1,isPhoneBox:!1,protocol:!1,isShow:!1,logoUrl:"",code:"",codeVal:"",authKey:"",options:"",userInfo:{},codeNum:0,canUseGetUserProfile:!1,canGetPrivacySetting:!1,inAnimation:!1,colorStatus:t.getStorageSync("color_status"),mp_is_new:this.$Cache.get("MP_VERSION_ISNEW")||!1,configData:f.default.get("BASIC_CONFIG"),bindPhone:!1,wechat_phone_switch:0}},computed:function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?g(Object(n),!0).forEach((function(e){(0,a.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},(0,l.configMap)({login_logo:"",site_name:"",first_avatar_switch:""},(0,h.mapGetters)(["isLogin","viewColor"]))),components:{editUserModal:function(){Promise.all([n.e("common/vendor"),n.e("components/eidtUserModal/index")]).then(function(){return resolve(n("e85b"))}.bind(null,n)).catch(n.oe)},privacyAgreementPopup:function(){n.e("components/privacyAgreementPopup/index").then(function(){return resolve(n("7a9b"))}.bind(null,n)).catch(n.oe)}},watch:{},onLoad:function(e){t.getUserProfile&&(this.canUseGetUserProfile=!0),i.getPrivacySetting&&(this.canGetPrivacySetting=!0);var n=getCurrentPages(),o=n[n.length-2];o&&"pages/order_addcart/order_addcart"==o.route?this.isHome=!0:this.isHome=!1},onReady:function(){this.getCode()},created:function(){i.getUserProfile&&(this.canUseGetUserProfile=!0)},methods:{getCode:function(){var e=this;u.default.getCode().then((function(n){t.hideLoading(),e.code=n;var i={code:n,spread:p.globalData.spid};(0,r.getAuthType)(i).then((function(n){e.bindPhone=n.data.bindPhone,e.wechat_phone_switch=n.data.wechat_phone_switch,t.setStorageSync("auth_token",n.data.key)})).catch((function(e){t.showToast({title:e,duration:2e3})}))})).catch((function(e){t.hideLoading(),t.showToast({title:"登录失败",duration:2e3})}))},getAuthLogin:function(){var e=this,n=this;if(!n.protocol&&!n.canUseGetUserProfile)return n.$util.Tips({title:"请勾选用户协议与隐私政策"});t.showLoading({title:"正在登录中"}),n.canUseGetUserProfile=!1,u.default.getUserProfile().then((function(i){var o=i.userInfo;o.code=n.code,o.spread=p.globalData.spid,o.spread_code=p.globalData.code,(0,c.commonAuth)({auth:{type:"routine",auth:o}}).then((function(i){if(200!=i.data.status)return t.setStorageSync("auth_token",i.data.result.key),t.navigateTo({url:"/pages/users/login/index"});var o=i.data.result.expires_time-f.default.time();n.$store.commit("UPDATE_USERINFO",i.data.result.user),n.$store.commit("LOGIN",{token:i.data.result.token,time:o}),n.$store.commit("SETUID",i.data.result.user.uid),f.default.set(s.EXPIRES_TIME,i.data.result.expires_time,o),f.default.set(s.USER_INFO,i.data.result.user,o),i.data.result.user.isNew&&n.mp_is_new&&1==n.first_avatar_switch?(t.hideLoading(),n.isShow=!0):e.$util.Tips({title:"授权成功",icon:"success"},{tab:3})})).catch((function(e){t.hideLoading(),t.showToast({title:e,icon:"none",duration:2e3})}))})).catch((function(e){t.hideLoading()}))},onAgree:function(){this.protocol=!0},ChangeIsDefault:function(t){this.$set(this,"protocol",!this.protocol)},editSuccess:function(){this.isShow=!1},closeEdit:function(){this.isShow=!1,this.$util.Tips({title:"登录成功",icon:"success"},{tab:3})},onReject:function(){t.switchTab({url:"/pages/index/index"})},back:function(){this.isLogin&&this.$store.commit("LOGIN",{token:"",time:0}),t.navigateBack()},home:function(){t.switchTab({url:"/pages/index/index"})},maskClose:function(t){this.isUp=!1,t&&(this.isShow=!0)},bindPhoneClose:function(t){this.isPhoneBox=!1,t.isStatus&&this.getUserInfo(t.new_user)},getphonenumber:function(e){var n=this;if(!n.protocol&&!n.canGetPrivacySetting)return n.$util.Tips({title:"请勾选用户协议与隐私政策"});e.detail.iv&&u.default.getCode().then((function(i){t.hideLoading(),n.code=i,(0,r.loginMpPhone)({iv:e.detail.iv,encryptedData:e.detail.encryptedData,code:i,auth_token:t.getStorageSync("auth_token")}).then((function(e){var i,o=e.data,a=n.$Cache.get("login_back_url")||"/pages/index/index";n.$Cache.clear("login_back_url"),n.$store.commit("LOGIN",{token:o.token,time:o.exp}),n.$store.commit("SETUID",o.user.uid),n.$store.commit("UPDATE_USERINFO",o.user);i=["/pages/index/index","/pages/order_addcart/order_addcart","/pages/goods_cate/goods_cate","/pages/user/index","/pages/plant_grass/index"].includes(n.getPath(a))?"switchTab":"navigateTo","/pages/users/login/index"!==n.getPath(a)?t[i]({url:a}):t.switchTab({url:"/pages/index/index"})})).catch((function(t){n.$util.Tips({title:t})}))})).catch((function(e){t.hideLoading(),t.showToast({title:"登录失败",duration:2e3})}))},getPath:function(t){return-1!=t.indexOf("?")&&(t=t.split("?")[0]),t},getUserInfo:function(e,n){var i=this,o=this;(0,r.getUserInfo)().then((function(n){t.hideLoading(),o.userInfo=n.data,o.$store.commit("SETUID",n.data.uid),o.$store.commit("UPDATE_USERINFO",n.data),e?i.isShow=!0:o.$util.Tips({title:"登录成功",icon:"success"},{tab:3})})).catch((function(e){t.hideLoading(),t.showToast({title:e.msg,icon:"none",duration:2e3})}))},privacy:function(e){t.navigateTo({url:"/pages/users/privacy/index?type="+e})}}};e.default=_}).call(this,n("543d")["default"],n("bc2e")["default"])},"5ae1":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.inAnimation=!1})},o=[]},"5c11":function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("4c7d");i(n("66fd"));var o=i(n("f356"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"770e":function(t,e,n){"use strict";n.r(e);var i=n("562f"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},"8fc7":function(t,e,n){},ad36:function(t,e,n){"use strict";var i=n("8fc7"),o=n.n(i);o.a},f356:function(t,e,n){"use strict";n.r(e);var i=n("5ae1"),o=n("770e");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("ad36");var c=n("f0c5"),s=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],void 0);e["default"]=s.exports}},[["5c11","common/runtime","common/vendor"]]]);