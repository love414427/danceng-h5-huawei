(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/plantGrass/plant_release/index"],{"3aa2":function(t,e,i){"use strict";i.r(e);var a=i("cbe6"),o=i.n(a);for(var n in a)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=o.a},"523e":function(t,e,i){},"7ab6":function(t,e,i){"use strict";var a=i("523e"),o=i.n(a);o.a},9981:function(t,e,i){"use strict";(function(t,e){var a=i("4ea4");i("4c7d");a(i("66fd"));var o=a(i("f1cb"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},cbe6:function(t,e,i){"use strict";(function(t){var a=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=a(i("448a")),n=a(i("9523")),r=i("26cb"),c=i("f26a"),s=i("ddb3"),d=i("3fd7"),u=i("6859"),l=i("5a8f"),p=i("3255"),f=a(i("2e02"));function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,a)}return i}function h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(Object(i),!0).forEach((function(e){(0,n.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var g={components:{avatar:function(){Promise.all([i.e("common/vendor"),i.e("components/yq-avatar/yq-avatar")]).then(function(){return resolve(i("b70d"))}.bind(null,i)).catch(i.oe)},associated:function(){i.e("pages/plantGrass/components/associated").then(function(){return resolve(i("66f0"))}.bind(null,i)).catch(i.oe)},participateTopic:function(){i.e("pages/plantGrass/components/participateTopic").then(function(){return resolve(i("cda4"))}.bind(null,i)).catch(i.oe)},bindmobile:function(){Promise.all([i.e("common/vendor"),i.e("components/bindmobile")]).then(function(){return resolve(i("5802"))}.bind(null,i)).catch(i.oe)},easyLoadimage:function(){Promise.all([i.e("common/vendor"),i.e("components/easy-loadimage/easy-loadimage")]).then(function(){return resolve(i("2243"))}.bind(null,i)).catch(i.oe)}},data:function(){return(0,n.default)({formData:{image:[],content:"",topic_id:"",spu_id:[],video_link:""},imageSrc:"",productList:[],topicName:{},isUpload:!0,showCd:!1,id:"",order_id:"",imgName:"",upload_max:50,uploadUrl:"".concat(c.HTTP_REQUEST_URL,"/api/upload/video"),tabList:[{name:"图文",value:1,icon:"icon-tuwen"},{name:"视频",value:2,icon:"icon-shipin"}],tabActive:1,tabLength:3,isPlay:!1,videoContext:"",video_link:"",showVideo:!1,videoplay:!1},"videoContext","")},computed:h(h(h({},(0,r.mapGetters)(["isLogin","viewColor","uid"])),(0,p.configMap)({community_app_switch:[]})),{},{videoHtml:function(){return'<video autoplay loop muted controls="controls" width="100%" height="500rpx"><source src="'.concat(this.formData.video_link,'" type="video/mp4"></video>')}}),watch:{},mounted:function(){this.videoContext=t.createVideoContext("myVideo",this)},onLoad:function(e){this.id=e.id,this.order_id=e.order_id,1==this.community_app_switch.length?1==this.community_app_switch[0]?this.tabLength=1:this.tabLength=2:0==this.community_app_switch.length&&(this.tabLength=1),this.isLogin?(this.id?this.getDetail():2==this.tabLength||3==this.tabLength?(this.formData.video_link=(0,l.getStorage)("video_link")||"",2==this.tabLength?this.formData.image=(0,l.getStorage)("imageArr")&&(0,l.getStorage)("imageArr").length>0?[(0,l.getStorage)("imageArr")[0]]:[]:this.formData.image=(0,l.getStorage)("imageArr")||[]):this.formData.image=(0,l.getStorage)("imageArr")||[],this.order_id&&this.getOrderGoods()):(0,s.toLogin)(),this.videoContext=t.createVideoContext("myvideo",this)},methods:{getDetail:function(){var t=this;(0,d.plantDetailApi)(t.id).then((function(e){t.formData=e.data,t.productList=e.data.relevance||[],t.topicName=e.data.topic||{}})).catch((function(e){return t.$util.Tips({title:e})}))},getOrderGoods:function(){var t=this;(0,d.orderAssociatePlantApi)(t.order_id).then((function(e){t.productList=e.data||[],t.formData.spu_id=e.data.map((function(t){return t.spu_id}))})).catch((function(e){return t.$util.Tips({title:e})}))},deleteTopic:function(){this.formData.topic={},this.topicName={}},deleteLink:function(){this.formData.video_link="",this.showVideo=!1,(0,l.setStorage)("video_link","")},clk:function(t){var e=this;e.$util.uploadImageOne({url:"upload/image",count:t},(function(i){if(1==t)e.formData.image=[i.data.path];else{var a=[];i.map((function(t){a.push(t)})),e.formData.image=[].concat((0,o.default)(e.formData.image),a),e.formData.image.length>=9&&(e.formData.image.length=9)}(0,l.setStorage)("imageArr",e.formData.image)}))},doUpload:function(e){var i=this;t.uploadFile({url:c.HTTP_REQUEST_URL+"/api/upload/image/field",filePath:e,name:"field",formData:{filename:e,name:i.imgName},header:(0,n.default)({"Content-Type":"multipart/form-data"},c.TOKENNAME,"Bearer "+f.default.state.app.token),success:function(e){var a=JSON.parse(e.data);a.data.path&&(i.formData.image.push(a.data.path),t.hideLoading())},complete:function(t){}})},uploadVideo:function(){var e=this;t.chooseVideo({sourceType:["camera","album"],success:function(i){t.showLoading({title:"视频上传中"}),Math.ceil(i.size/1024)<1024*e.upload_max?t.uploadFile({url:e.uploadUrl,filePath:i.tempFilePath,name:"file",formData:{user:"test"},header:(0,n.default)({"Content-Type":"multipart/form-data"},c.TOKENNAME,"Bearer "+f.default.state.app.token),success:function(i){t.hideLoading();var a=JSON.parse(i.data);e.formData.video_link=a.data.src,(0,l.setStorage)("video_link",e.formData.video_link)},complete:function(e){t.hideLoading()},fail:function(i){t.hideLoading(),e.Tips({title:i.message})}}):(t.hideLoading(),t.showModal({title:"提示",content:"视频超出限制".concat(e.upload_max,"MB")}))},fail:function(t){e.$util.Tips({title:t})}})},getImgName:function(t){this.imgName=t},DelPic:function(t){this.formData.image.splice(t,1),(0,l.setStorage)("imageArr",this.formData.image)},addProduct:function(){this.$refs.associated.open()},addTopic:function(){this.$refs.participateTopic.open()},close:function(){this.$refs.associated.close(),this.$refs.participateTopic.close()},videoshow:function(){var e=this;this.showVideo=!0,this.videoContext=t.createVideoContext("myVideo",this),this.$nextTick((function(){e.videoContext.play()}))},screenChange:function(t){var e=t.detail.fullScreen;e||(this.videoplay=!1)},getProduct:function(t){this.productList=t,this.formData.spu_id=t.map((function(t){return t.spu_id})),this.$refs.associated.close()},getTopic:function(t){t.topic_id?this.topicName=t:this.topicName={},this.formData.topic_id=t.topic_id,this.$refs.participateTopic.close()},formSubmit:function(t){var e=this;(0,u.getUserInfo)().then((function(t){t.data.phone?e.submitData():e.$refs.bindmobile.open()}))},closepoup:function(){this.$refs.bindmobile.close()},submitData:function(){var e=this,i=e.formData;if(e.tabActive=e.formData.video_link?2:1,e.isLogin){if(0==i.image.length)return e.$util.Tips({title:"请添加话题图片"});if(!i.content)return e.$util.Tips({title:"请分享使用心得和体会"});if(2==e.tabLength&&!i.video_link)return e.$util.Tips({title:"请添加话题视频"});e.id&&i.relevance.length&&(i.spu_id=i.relevance.map((function(t){return t.spu&&t.spu.spu_id||t.spu_id}))),i.order_id=e.order_id,i.is_type=e.tabActive,t.showLoading({title:"保存中",mask:!0}),e.id?(0,d.updatePlantApi)(e.id,i).then((function(i){t.hideLoading(),e.$util.Tips({title:i.messge,icon:"success"}),(0,l.setStorage)("video_link",""),(0,l.setStorage)("imageArr",[]),2==e.tabActive?t.navigateTo({url:"/pages/short_video/nvueSwiper/index?id="+i.data.community_id+"&user=1&uid="+e.uid}):t.redirectTo({url:"/pages/plantGrass/plant_detail/index?id="+i.data.community_id+"&type="+e.tabActive})})).catch((function(t){return e.$util.Tips({title:t})})):(0,d.createPlantApi)(i).then((function(i){t.hideLoading(),e.$util.Tips({title:i.messge,icon:"success"}),(0,l.setStorage)("video_link",""),(0,l.setStorage)("imageArr",[]),2==e.tabActive?t.navigateTo({url:"/pages/short_video/nvueSwiper/index?id="+i.data.community_id+"&user=1&uid="+e.uid}):t.redirectTo({url:"/pages/plantGrass/plant_detail/index?id="+i.data.community_id+"&type="+e.tabActive})})).catch((function(t){return e.$util.Tips({title:t})}))}else(0,s.toLogin)()}}};e.default=g}).call(this,i("543d")["default"])},ccc8:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));var a={easyLoadimage:function(){return Promise.all([i.e("common/vendor"),i.e("components/easy-loadimage/easy-loadimage")]).then(i.bind(null,"2243"))},uniPopup:function(){return i.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(i.bind(null,"b4af"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,2!=t.tabLength&&3!=t.tabLength||t.formData.video_link?null:!t.formData.video_link&&t.formData.image.length<=1),a=2!=t.tabLength&&3!=t.tabLength||!(3==t.tabLength&&t.formData.video_link||2==t.tabLength)?null:t.formData.image.length,o=1==t.tabLength&&!t.formData.video_link||3==t.tabLength&&!t.formData.video_link?t.formData.image.length:null,n=t.productList.length,r=t.productList.length;t._isMounted||(t.e0=function(e){e.stopPropagation(),t.showVideo=!1}),t.$mp.data=Object.assign({},{$root:{g0:i,g1:a,g2:o,g3:n,g4:r}})},n=[]},f1cb:function(t,e,i){"use strict";i.r(e);var a=i("ccc8"),o=i("3aa2");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);i("7ab6");var r=i("f0c5"),c=Object(r["a"])(o["default"],a["b"],a["c"],!1,null,"f51cac3e",null,!1,a["a"],void 0);e["default"]=c.exports}},[["9981","common/runtime","common/vendor"]]]);